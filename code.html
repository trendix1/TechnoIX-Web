<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TechnoIX Code Pad Final</title>
<style>
:root{
  --bg:#0b1220;--panel:#0f1724;--muted:#99b3c6;
  --logo-grad:linear-gradient(90deg,#3aa0ff,#0056d6);
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:#e6eef8;
  font-family:Arial,Helvetica,sans-serif;height:100vh;overflow:hidden;
  display:flex;flex-direction:column;
}
.topbar{
  height:60px;display:flex;align-items:center;padding:0 16px;
  background:linear-gradient(90deg,#071126,#0b2540);flex-shrink:0;
}
.logo{font-weight:800;font-size:18px;background:var(--logo-grad);
  -webkit-background-clip:text;color:transparent;}
.controls{margin-left:auto;display:flex;gap:8px;}
.btn{
  background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);
  color:#cfeefc;padding:6px 12px;border-radius:8px;cursor:pointer;font-weight:600;
}
#main{
  flex:1;
  display:grid;
  grid-template-columns:220px 1fr 400px;
  grid-template-rows:1fr;
  height:calc(100vh - 60px);
  overflow:hidden;
}
#explorer{background:#081224;border-right:1px solid rgba(255,255,255,.05);padding:8px;overflow:auto;}
#explorer h3{margin:8px 0;font-size:14px;color:#8fb2ff;}
#files{list-style:none;padding:0;margin:0;}
#files li{padding:6px 8px;border-radius:6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
#files li .name{flex:1;padding-right:8px;}
.file-actions{display:flex;gap:6px;align-items:center;}
.file-actions button{background:transparent;border:none;color:inherit;cursor:pointer;font-size:13px;padding:4px;border-radius:4px;}
#editor-area{display:flex;flex-direction:column;height:100%;background:#0f1724;}
#tabs{display:flex;background:#0f1724;border-bottom:1px solid rgba(255,255,255,.1);overflow:auto;}
.tab{padding:8px 12px;cursor:pointer;font-size:13px;border-right:1px solid rgba(255,255,255,.05);display:flex;align-items:center;gap:8px;}
.tab .close{font-weight:700;opacity:0.6;padding:2px 6px;border-radius:6px;}
.tab.active{background:rgba(255,255,255,.07);}
#editor{flex:1;min-height:0;height:100%;}
#right-panel{display:flex;flex-direction:column;background:#071126;border-left:1px solid rgba(255,255,255,.05);}
#preview{flex:2;border:none;background:white;height:50%;}
#terminal-panel{flex:1;display:flex;flex-direction:column;border-top:1px solid rgba(255,255,255,.05);height:50%;}
.panel{flex:1;padding:6px;font-family:monospace;font-size:13px;overflow:auto;}
.overlay{
  position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;
}
.card{background:#0b1220;border:1px solid rgba(255,255,255,0.08);padding:20px;border-radius:10px;width:420px;box-shadow:0 8px 30px rgba(0,0,0,0.6);}
.progress{height:10px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden;margin-top:12px;}
.progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#3aa0ff,#0056d6);border-radius:6px;}
.small{font-size:13px;color:var(--muted);margin-top:8px;}
.empty{color:rgba(255,255,255,0.35);padding:10px;text-align:center;border-radius:6px;}

/* Responsive fix */
@media (max-width:900px){
  #main{grid-template-columns:1fr;grid-template-rows:auto auto 1fr;overflow:auto;}
  #explorer{height:150px;border-bottom:1px solid rgba(255,255,255,.05);}
  #editor-area{height:40vh;}
  #right-panel{height:auto;}
}
</style>
</head>
<body>
<div class="topbar">
  <div class="logo">TechnoIX Code Pad</div>
  <div class="controls">
    <button id="runBtn" class="btn">Run</button>
    <button id="formatBtn" class="btn">Format</button>
    <button id="exportBtn" class="btn">Export</button>
    <button id="importBtn" class="btn">Import</button>
  </div>
</div>
<div id="main">
  <div id="explorer">
    <h3>Explorer</h3>
    <ul id="files"></ul>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button id="newFileBtn" class="btn" style="flex:1;">+ New File</button>
    </div>
  </div>
  <div id="editor-area">
    <div id="tabs"></div>
    <div id="editor"></div>
  </div>
  <div id="right-panel">
    <iframe id="preview"></iframe>
    <div id="terminal-panel">
      <div class="panel" id="console"></div>
      <div class="panel" id="terminal"></div>
    </div>
  </div>
</div>

<!-- Pyodide overlay -->
<div id="pyodideOverlay" style="display:none;">
  <div class="overlay">
    <div class="card">
      <div style="font-weight:800;font-size:16px;">Memuat Pyodide...</div>
      <div id="pyStatus" class="small">Menghubungkan...</div>
      <div class="progress"><i id="pyProgress"></i></div>
      <div class="small" style="text-align:right;margin-top:8px;"><button id="pyCancel" class="btn">Batal</button></div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/parser-babel.js"></script>
<script>
require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs'}});
let editor,files={},activeFile=null;const STORAGE_KEY='technoix_files_final';
function logConsole(m){const c=document.getElementById('console');const d=document.createElement('div');d.textContent=new Date().toLocaleTimeString()+' - '+m;c.appendChild(d);c.scrollTop=c.scrollHeight;}
function saveFiles(){localStorage.setItem(STORAGE_KEY,JSON.stringify(files));}
function loadFiles(){try{files=JSON.parse(localStorage.getItem(STORAGE_KEY))||{};}catch(e){files={};}}
function refreshFiles(){const ul=document.getElementById('files');ul.innerHTML='';Object.keys(files).forEach(f=>{const li=document.createElement('li');const s=document.createElement('span');s.className='name';s.textContent=f;s.onclick=()=>openFile(f);const del=document.createElement('button');del.textContent='âœ•';del.onclick=(e)=>{e.stopPropagation();if(confirm('Hapus file '+f+'?')){delete files[f];saveFiles();refreshFiles();if(activeFile===f){editor.setValue('');}}};const fa=document.createElement('div');fa.className='file-actions';fa.appendChild(del);li.appendChild(s);li.appendChild(fa);ul.appendChild(li);});if(!Object.keys(files).length){ul.innerHTML='<div class="empty">No files</div>';}}
function openFile(f){activeFile=f;editor.setValue(files[f].content||'');monaco.editor.setModelLanguage(editor.getModel(),files[f].lang);}
function addFile(name,lang){if(!name)return;if(files[name])return openFile(name);files[name]={content:'',lang};saveFiles();refreshFiles();openFile(name);}
require(['vs/editor/editor.main'],function(){editor=monaco.editor.create(document.getElementById('editor'),{value:'',language:'html',theme:'vs-dark',automaticLayout:true});editor.onDidChangeModelContent(()=>{if(activeFile){files[activeFile].content=editor.getValue();saveFiles();autoFormat();}});editor.onDidChangeModelContent((e)=>{if(files[activeFile]?.lang==='html'&&editor.getValue().trim()==='!'){editor.setValue('<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Document</title>\n</head>\n<body>\n\n</body>\n</html>');}});loadFiles();if(!Object.keys(files).length)addFile('index.html','html');refreshFiles();openFile(Object.keys(files)[0]);});
let autoFmt;function autoFormat(){clearTimeout(autoFmt);autoFmt=setTimeout(()=>{if(activeFile&&files[activeFile].lang==='html'){try{const f=prettier.format(editor.getValue(),{parser:'html',plugins:prettierPlugins});editor.setValue(f);}catch(e){}}},2000);}
document.getElementById('newFileBtn').onclick=()=>{const n=prompt('File name');if(!n)return;const e=n.split('.').pop();addFile(n,e==='js'?'javascript':e==='py'?'python':'html');};
document.getElementById('formatBtn').onclick=()=>{autoFormat();};
document.getElementById('runBtn').onclick=async()=>{if(!activeFile)return;const f=files[activeFile];const code=f.content;const lang=f.lang;if(lang==='html'){document.getElementById('preview').srcdoc=code;logConsole('Preview HTML');}else if(lang==='javascript'){document.getElementById('preview').srcdoc='<!doctype html><script>'+code+'</script>';logConsole('Run JS');}else if(lang==='python'){await ensurePyodide();try{const res=await window.pyodide.runPythonAsync(code);logConsole(res||'[Done]');}catch(e){logConsole('Error: '+e);}}};
document.getElementById('exportBtn').onclick=()=>{if(!activeFile)return;const b=new Blob([files[activeFile].content],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=activeFile;a.click();};
document.getElementById('importBtn').onclick=()=>{const i=document.createElement('input');i.type='file';i.multiple=true;i.onchange=e=>{Array.from(e.target.files).forEach(f=>{const r=new FileReader();r.onload=()=>addFile(f.name,f.name.endsWith('.js')?'javascript':f.name.endsWith('.py')?'python':'html');r.readAsText(f);});};i.click();};
async function ensurePyodide(){if(window.pyodide)return;window.pyodide=await loadPyodide({indexURL:'https://cdn.jsdelivr.net/pyodide/v0.23.4/full/'});logConsole('Pyodide loaded');}
window.onresize=()=>{if(editor)editor.layout();};
</script>
</body>
</html>