
Action: file_editor create /app/code-improved.html --file-text "<!DOCTYPE html>
<html lang=\"en\">
<head>
<meta charset=\"UTF-8\" />
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>
<title>TechnoIX Code Pad - Enhanced</title>
<style>
:root{
  --bg-primary:#0a0e1a;
  --bg-secondary:#0f1724;
  --bg-tertiary:#1a2332;
  --border-color:rgba(255,255,255,.08);
  --text-primary:#e6eef8;
  --text-secondary:#99b3c6;
  --text-muted:#5a6b7d;
  --accent-blue:#3aa0ff;
  --accent-blue-dark:#0056d6;
  --accent-green:#00d98e;
  --accent-purple:#a78bfa;
  --accent-orange:#ff9e64;
  --hover-bg:rgba(255,255,255,.05);
  --active-bg:rgba(255,255,255,.1);
  --logo-grad:linear-gradient(135deg,#3aa0ff,#a78bfa);
  --success:#00d98e;
  --warning:#fbbf24;
  --error:#ef4444;
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  background:var(--bg-primary);
  color:var(--text-primary);
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  height:100vh;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* Topbar Styles */
.topbar{
  height:56px;
  display:flex;
  align-items:center;
  padding:0 20px;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border-color);
  flex-shrink:0;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}

.logo{
  display:flex;
  align-items:center;
  gap:12px;
  font-weight:700;
  font-size:16px;
  background:var(--logo-grad);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}

.logo svg{
  width:28px;
  height:28px;
  flex-shrink:0;
}

.topbar-center{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  padding:0 20px;
}

.file-info{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 14px;
  background:var(--bg-tertiary);
  border-radius:8px;
  font-size:13px;
  color:var(--text-secondary);
  border:1px solid var(--border-color);
}

.file-info .icon{
  width:16px;
  height:16px;
}

.controls{
  display:flex;
  gap:8px;
}

.btn{
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--hover-bg);
  border:1px solid var(--border-color);
  color:var(--text-primary);
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:500;
  font-size:13px;
  transition:all .2s ease;
}

.btn:hover{
  background:var(--active-bg);
  border-color:var(--accent-blue);
  transform:translateY(-1px);
}

.btn:active{
  transform:translateY(0);
}

.btn.primary{
  background:linear-gradient(135deg,var(--accent-blue),var(--accent-blue-dark));
  border-color:transparent;
  color:white;
}

.btn.primary:hover{
  box-shadow:0 4px 12px rgba(58,160,255,.3);
}

.btn svg{
  width:16px;
  height:16px;
}

/* Main Layout */
#main{
  flex:1;
  display:grid;
  grid-template-columns:280px 1fr 450px;
  height:calc(100vh - 56px);
  overflow:hidden;
  position:relative;
}

/* Explorer Panel */
#explorer{
  background:var(--bg-secondary);
  border-right:1px solid var(--border-color);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.explorer-header{
  padding:16px;
  border-bottom:1px solid var(--border-color);
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.explorer-header h3{
  font-size:13px;
  font-weight:600;
  color:var(--text-secondary);
  text-transform:uppercase;
  letter-spacing:0.5px;
}

#files{
  list-style:none;
  padding:8px;
  overflow:auto;
  flex:1;
}

#files li{
  padding:10px 12px;
  border-radius:6px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:all .15s ease;
  margin-bottom:2px;
}

#files li:hover{
  background:var(--hover-bg);
}

#files li.active{
  background:var(--active-bg);
  border-left:3px solid var(--accent-blue);
}

#files li .name{
  flex:1;
  display:flex;
  align-items:center;
  gap:10px;
  font-size:14px;
  color:var(--text-primary);
}

#files li .name svg{
  width:18px;
  height:18px;
  flex-shrink:0;
}

.file-actions{
  display:flex;
  gap:4px;
  opacity:0;
  transition:opacity .15s ease;
}

#files li:hover .file-actions{
  opacity:1;
}

.file-actions button{
  background:transparent;
  border:none;
  color:var(--text-secondary);
  cursor:pointer;
  width:24px;
  height:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:4px;
  transition:all .15s ease;
}

.file-actions button:hover{
  background:var(--error);
  color:white;
}

.explorer-footer{
  padding:12px;
  border-top:1px solid var(--border-color);
}

/* Editor Area */
#editor-area{
  display:flex;
  flex-direction:column;
  background:var(--bg-primary);
  position:relative;
}

#tabs{
  display:flex;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border-color);
  overflow-x:auto;
  scrollbar-width:thin;
}

#tabs::-webkit-scrollbar{
  height:4px;
}

#tabs::-webkit-scrollbar-track{
  background:transparent;
}

#tabs::-webkit-scrollbar-thumb{
  background:var(--border-color);
  border-radius:2px;
}

.tab{
  padding:10px 16px;
  cursor:pointer;
  font-size:13px;
  border-right:1px solid var(--border-color);
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--bg-secondary);
  transition:all .15s ease;
  position:relative;
  min-width:fit-content;
}

.tab:hover{
  background:var(--hover-bg);
}

.tab.active{
  background:var(--bg-primary);
  border-bottom:2px solid var(--accent-blue);
}

.tab svg{
  width:14px;
  height:14px;
}

.tab .close{
  opacity:0;
  width:18px;
  height:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:4px;
  transition:all .15s ease;
  color:var(--text-muted);
}

.tab:hover .close{
  opacity:1;
}

.tab .close:hover{
  background:var(--error);
  color:white;
}

#editor{
  flex:1;
  min-height:0;
  position:relative;
}

.editor-status{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  height:28px;
  background:var(--bg-secondary);
  border-top:1px solid var(--border-color);
  display:flex;
  align-items:center;
  padding:0 16px;
  font-size:11px;
  color:var(--text-secondary);
  gap:20px;
  z-index:10;
}

.status-item{
  display:flex;
  align-items:center;
  gap:6px;
}

/* Right Panel */
#right-panel{
  display:flex;
  flex-direction:column;
  background:var(--bg-secondary);
  border-left:1px solid var(--border-color);
}

.panel-header{
  padding:10px 16px;
  background:var(--bg-tertiary);
  border-bottom:1px solid var(--border-color);
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:12px;
  font-weight:600;
  color:var(--text-secondary);
  text-transform:uppercase;
  letter-spacing:0.5px;
}

.panel-header .actions{
  display:flex;
  gap:6px;
}

.panel-header button{
  background:transparent;
  border:none;
  color:var(--text-muted);
  cursor:pointer;
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:4px;
  transition:all .15s ease;
}

.panel-header button:hover{
  background:var(--hover-bg);
  color:var(--text-primary);
}

#preview-container{
  flex:1.5;
  display:flex;
  flex-direction:column;
  border-bottom:1px solid var(--border-color);
  min-height:0;
}

#preview{
  flex:1;
  border:none;
  background:white;
  width:100%;
}

#terminal-container{
  flex:1;
  display:flex;
  flex-direction:column;
  min-height:0;
}

#terminal-panel{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.panel{
  flex:1;
  padding:12px;
  font-family:'Consolas','Monaco','Courier New',monospace;
  font-size:12px;
  overflow:auto;
  line-height:1.6;
}

.panel::-webkit-scrollbar{
  width:8px;
}

.panel::-webkit-scrollbar-track{
  background:var(--bg-secondary);
}

.panel::-webkit-scrollbar-thumb{
  background:var(--border-color);
  border-radius:4px;
}

.panel::-webkit-scrollbar-thumb:hover{
  background:var(--text-muted);
}

/* Console output styling */
#console div{
  padding:4px 0;
  border-bottom:1px solid rgba(255,255,255,.02);
}

#console div:last-child{
  border-bottom:none;
}

/* Overlay */
.overlay{
  position:fixed;
  left:0;
  top:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.75);
  backdrop-filter:blur(4px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  animation:fadeIn .2s ease;
}

@keyframes fadeIn{
  from{opacity:0;}
  to{opacity:1;}
}

.card{
  background:var(--bg-secondary);
  border:1px solid var(--border-color);
  padding:28px;
  border-radius:12px;
  width:480px;
  box-shadow:0 20px 60px rgba(0,0,0,0.5);
  animation:slideUp .3s ease;
}

@keyframes slideUp{
  from{
    opacity:0;
    transform:translateY(20px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

.card h3{
  font-size:18px;
  font-weight:700;
  color:var(--text-primary);
  margin-bottom:8px;
}

.progress{
  height:8px;
  background:var(--bg-tertiary);
  border-radius:4px;
  overflow:hidden;
  margin-top:16px;
}

.progress > i{
  display:block;
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent-blue),var(--accent-purple));
  border-radius:4px;
  transition:width .3s ease;
}

.small{
  font-size:13px;
  color:var(--text-secondary);
  margin-top:12px;
}

.empty{
  color:var(--text-muted);
  padding:20px;
  text-align:center;
  border-radius:6px;
  font-size:13px;
}

/* Resizer */
.resizer{
  width:4px;
  background:transparent;
  cursor:col-resize;
  position:relative;
  transition:background .2s ease;
}

.resizer:hover{
  background:var(--accent-blue);
}

.resizer::after{
  content:'';
  position:absolute;
  top:0;
  bottom:0;
  left:-4px;
  right:-4px;
}

/* Responsive */
@media (max-width:1200px){
  #main{
    grid-template-columns:250px 1fr 380px;
  }
}

@media (max-width:900px){
  #main{
    grid-template-columns:1fr;
    grid-template-rows:auto;
  }
  
  #explorer{
    display:none;
  }
  
  #right-panel{
    display:none;
  }
  
  .topbar-center{
    display:none;
  }
}

/* Utility */
.hidden{
  display:none !important;
}

/* File type colors */
.file-html{color:#e34c26;}
.file-css{color:#264de4;}
.file-js{color:#f7df1e;}
.file-py{color:#3776ab;}
.file-json{color:#00d98e;}
.file-md{color:#a78bfa;}
.file-default{color:var(--text-secondary);}
</style>
</head>
<body>
<!-- Topbar -->
<div class=\"topbar\">
  <div class=\"logo\">
    <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">
      <path d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\" fill=\"url(#gradient)\"/>
      <defs>
        <linearGradient id=\"gradient\" x1=\"2\" y1=\"2\" x2=\"22\" y2=\"22\">
          <stop offset=\"0%\" stop-color=\"#3aa0ff\"/>
          <stop offset=\"100%\" stop-color=\"#a78bfa\"/>
        </linearGradient>
      </defs>
    </svg>
    TechnoIX Code Pad
  </div>
  
  <div class=\"topbar-center\">
    <div class=\"file-info\">
      <svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <path d=\"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z\"/>
        <polyline points=\"13 2 13 9 20 9\"/>
      </svg>
      <span id=\"currentFile\">No file open</span>
    </div>
  </div>
  
  <div class=\"controls\">
    <button id=\"runBtn\" class=\"btn primary\">
      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <polygon points=\"5 3 19 12 5 21 5 3\"/>
      </svg>
      Run
    </button>
    <button id=\"formatBtn\" class=\"btn\">
      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <polyline points=\"16 18 22 12 16 6\"/>
        <polyline points=\"8 6 2 12 8 18\"/>
      </svg>
      Format
    </button>
    <button id=\"exportBtn\" class=\"btn\">
      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>
        <polyline points=\"7 10 12 15 17 10\"/>
        <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>
      </svg>
      Export
    </button>
    <button id=\"importBtn\" class=\"btn\">
      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>
        <polyline points=\"17 8 12 3 7 8\"/>
        <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>
      </svg>
      Import
    </button>
  </div>
</div>

<!-- Main Layout -->
<div id=\"main\">
  <!-- Explorer -->
  <div id=\"explorer\">
    <div class=\"explorer-header\">
      <h3>Explorer</h3>
      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
        <path d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"/>
      </svg>
    </div>
    <ul id=\"files\"></ul>
    <div class=\"explorer-footer\">
      <button id=\"newFileBtn\" class=\"btn\" style=\"width:100%;\">
        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
          <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/>
          <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/>
        </svg>
        New File
      </button>
    </div>
  </div>
  
  <!-- Editor Area -->
  <div id=\"editor-area\">
    <div id=\"tabs\"></div>
    <div id=\"editor\"></div>
    <div class=\"editor-status\">
      <div class=\"status-item\">
        <span id=\"statusLang\">HTML</span>
      </div>
      <div class=\"status-item\">
        <span id=\"statusLine\">Ln 1, Col 1</span>
      </div>
      <div class=\"status-item\">
        <span id=\"statusChars\">0 chars</span>
      </div>
    </div>
  </div>
  
  <!-- Right Panel -->
  <div id=\"right-panel\">
    <div id=\"preview-container\">
      <div class=\"panel-header\">
        <span>Preview</span>
        <div class=\"actions\">
          <button title=\"Refresh\">
            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
              <polyline points=\"23 4 23 10 17 10\"/>
              <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>
            </svg>
          </button>
        </div>
      </div>
      <iframe id=\"preview\"></iframe>
    </div>
    
    <div id=\"terminal-container\">
      <div class=\"panel-header\">
        <span>Console</span>
        <div class=\"actions\">
          <button id=\"clearConsole\" title=\"Clear\">
            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
              <polyline points=\"3 6 5 6 21 6\"/>
              <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>
            </svg>
          </button>
        </div>
      </div>
      <div id=\"terminal-panel\">
        <div class=\"panel\" id=\"console\"></div>
      </div>
    </div>
  </div>
</div>

<!-- Pyodide Overlay -->
<div id=\"pyodideOverlay\" class=\"hidden\">
  <div class=\"overlay\">
    <div class=\"card\">
      <h3>Loading Pyodide...</h3>
      <div id=\"pyStatus\" class=\"small\">Connecting to Python runtime...</div>
      <div class=\"progress\"><i id=\"pyProgress\"></i></div>
      <div style=\"text-align:right;margin-top:16px;\">
        <button id=\"pyCancel\" class=\"btn\">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src=\"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js\"></script>
<script src=\"https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js\"></script>
<script src=\"https://unpkg.com/prettier@2.8.8/standalone.js\"></script>
<script src=\"https://unpkg.com/prettier@2.8.8/parser-html.js\"></script>
<script src=\"https://unpkg.com/prettier@2.8.8/parser-babel.js\"></script>

<script>
// File type icons
const FILE_ICONS = {
  html: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 17.56l-6.94 3.64 1.33-7.73L.66 8.27l7.81-1.13L12 .5l3.53 6.64 7.81 1.13-5.73 5.2 1.33 7.73z\"/></svg>',
  css: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M5 3l-.65 3.34h13.59L17.5 8.5H3.92l-.66 3.33h13.59l-.76 3.81-5.48 1.81-4.75-1.81.33-1.64H2.85l-.79 4 7.85 3 9.05-3 1.2-6.03.24-1.21L21.94 3z\"/></svg>',
  js: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M3 3h18v18H3V3m4.73 15.04c.4.85 1.19 1.55 2.54 1.55 1.5 0 2.53-.8 2.53-2.55v-5.78h-1.7V17c0 .86-.35 1.08-.9 1.08-.58 0-.82-.4-1.09-.87l-1.38.83m5.98-.18c.5.98 1.51 1.73 3.09 1.73 1.6 0 2.8-.83 2.8-2.36 0-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02 0-.41.31-.72.81-.72.5 0 .8.21 1.09.72l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51 0-2.48.96-2.48 2.23 0 1.38.81 2.03 2.03 2.55l.42.18c.78.34 1.24.55 1.24 1.13 0 .48-.45.83-1.15.83-.83 0-1.31-.43-1.67-1.03l-1.38.8z\"/></svg>',
  py: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M9.585 11.692h4.328s2.432.039 2.432-2.35V5.391S16.714 3 11.936 3C7.362 3 7.647 3 7.647 3L7.61 5.418h4.404v.633H5.967s-3.319-.365-3.319 4.845c0 5.211 2.89 5.021 2.89 5.021h1.725v-2.42s-.094-2.89 2.843-2.89zM9.5 4.598a.825.825 0 1 1 0 1.65.825.825 0 0 1 0-1.65z\"/><path d=\"M13.913 12.308h-4.328s-2.432-.039-2.432 2.35v3.951s-.369 2.391 4.409 2.391c4.573 0 4.288 0 4.288 0l.037-2.418H11.48v-.633h6.047s3.319.365 3.319-4.845c0-5.211-2.89-5.021-2.89-5.021h-1.725v2.42s.094 2.89-2.843 2.89zm.091 7.7a.825.825 0 1 1 0-1.65.825.825 0 0 1 0 1.65z\"/></svg>',
  json: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1z\"/></svg>',
  md: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M20.56 18H3.44C2.65 18 2 17.37 2 16.59V7.41C2 6.63 2.65 6 3.44 6h17.12c.79 0 1.44.63 1.44 1.41v9.18c0 .78-.65 1.41-1.44 1.41M6.81 15.19v-3.66l1.92 2.35 1.92-2.35v3.66h1.93V8.81h-1.93l-1.92 2.35-1.92-2.35H4.89v6.38zm11.5 0L21.89 12l-3.58-3.19v2.4H13.7v1.6h4.61z\"/></svg>',
  default: '<svg viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m0 18h12v-8H6v8z\"/></svg>'
};

// Get file icon and class
function getFileIcon(filename) {
  const ext = filename.split('.').pop().toLowerCase();
  const icon = FILE_ICONS[ext] || FILE_ICONS.default;
  const className = `file-${ext}` in {'file-html':1,'file-css':1,'file-js':1,'file-py':1,'file-json':1,'file-md':1} ? `file-${ext}` : 'file-default';
  return { icon, className };
}

// Monaco Editor setup
require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs'}});

let editor, files = {}, activeFile = null;
const STORAGE_KEY = 'technoix_files_enhanced';

// Console logging
function logConsole(msg, type = 'info') {
  const console = document.getElementById('console');
  const div = document.createElement('div');
  const time = new Date().toLocaleTimeString();
  const colors = {
    info: '#3aa0ff',
    success: '#00d98e',
    error: '#ef4444',
    warning: '#fbbf24'
  };
  div.innerHTML = `<span style=\"color:${colors[type]}\">[${time}]</span> ${msg}`;
  console.appendChild(div);
  console.scrollTop = console.scrollHeight;
}

// File management
function saveFiles() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(files));
}

function loadFiles() {
  try {
    files = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
  } catch(e) {
    files = {};
  }
}

function refreshFiles() {
  const ul = document.getElementById('files');
  ul.innerHTML = '';
  
  Object.keys(files).forEach(filename => {
    const { icon, className } = getFileIcon(filename);
    const li = document.createElement('li');
    if (activeFile === filename) li.classList.add('active');
    
    li.innerHTML = `
      <div class=\"name ${className}\">
        ${icon}
        <span>${filename}</span>
      </div>
      <div class=\"file-actions\">
        <button class=\"delete-btn\" data-file=\"${filename}\">✕</button>
      </div>
    `;
    
    li.querySelector('.name').onclick = () => openFile(filename);
    li.querySelector('.delete-btn').onclick = (e) => {
      e.stopPropagation();
      if(confirm(`Delete ${filename}?`)) {
        delete files[filename];
        saveFiles();
        refreshFiles();
        if(activeFile === filename) {
          const remaining = Object.keys(files);
          if(remaining.length > 0) {
            openFile(remaining[0]);
          } else {
            activeFile = null;
            editor.setValue('');
            updateFileInfo();
          }
        }
        refreshTabs();
      }
    };
    
    ul.appendChild(li);
  });
  
  if(!Object.keys(files).length) {
    ul.innerHTML = '<div class=\"empty\">No files yet<br><small>Click \"+ New File\" to start</small></div>';
  }
}

function refreshTabs() {
  const tabsContainer = document.getElementById('tabs');
  tabsContainer.innerHTML = '';
  
  Object.keys(files).forEach(filename => {
    const { icon, className } = getFileIcon(filename);
    const tab = document.createElement('div');
    tab.className = 'tab';
    if (activeFile === filename) tab.classList.add('active');
    
    tab.innerHTML = `
      <div class=\"${className}\">${icon}</div>
      <span>${filename}</span>
      <span class=\"close\" data-file=\"${filename}\">✕</span>
    `;
    
    tab.onclick = (e) => {
      if (!e.target.classList.contains('close')) {
        openFile(filename);
      }
    };
    
    tab.querySelector('.close').onclick = (e) => {
      e.stopPropagation();
      delete files[filename];
      saveFiles();
      refreshFiles();
      if(activeFile === filename) {
        const remaining = Object.keys(files);
        if(remaining.length > 0) {
          openFile(remaining[0]);
        } else {
          activeFile = null;
          editor.setValue('');
          updateFileInfo();
        }
      }
      refreshTabs();
    };
    
    tabsContainer.appendChild(tab);
  });
}

function openFile(filename) {
  activeFile = filename;
  editor.setValue(files[filename].content || '');
  monaco.editor.setModelLanguage(editor.getModel(), files[filename].lang);
  refreshFiles();
  refreshTabs();
  updateFileInfo();
}

function addFile(name, lang) {
  if(!name) return;
  if(files[name]) return openFile(name);
  files[name] = {content: '', lang};
  saveFiles();
  refreshFiles();
  refreshTabs();
  openFile(name);
  logConsole(`Created file: ${name}`, 'success');
}

function updateFileInfo() {
  const fileInfo = document.getElementById('currentFile');
  const statusLang = document.getElementById('statusLang');
  
  if(activeFile) {
    fileInfo.textContent = activeFile;
    const ext = activeFile.split('.').pop().toUpperCase();
    statusLang.textContent = ext;
  } else {
    fileInfo.textContent = 'No file open';
    statusLang.textContent = '-';
  }
}

function updateEditorStatus() {
  if(!editor) return;
  const position = editor.getPosition();
  const model = editor.getModel();
  const content = model.getValue();
  
  document.getElementById('statusLine').textContent = `Ln ${position.lineNumber}, Col ${position.column}`;
  document.getElementById('statusChars').textContent = `${content.length} chars`;
}

// Initialize Monaco Editor
require(['vs/editor/editor.main'], function() {
  editor = monaco.editor.create(document.getElementById('editor'), {
    value: '',
    language: 'html',
    theme: 'vs-dark',
    automaticLayout: true,
    fontSize: 14,
    minimap: { enabled: true },
    scrollBeyondLastLine: false,
    renderWhitespace: 'selection',
    lineNumbers: 'on',
    folding: true,
    bracketPairColorization: { enabled: true }
  });
  
  // Auto-save on change
  editor.onDidChangeModelContent(() => {
    if(activeFile) {
      files[activeFile].content = editor.getValue();
      saveFiles();
    }
    updateEditorStatus();
  });
  
  // Update status on cursor change
  editor.onDidChangeCursorPosition(() => {
    updateEditorStatus();
  });
  
  // HTML Emmet-like expansion
  editor.onDidChangeModelContent((e) => {
    if(files[activeFile]?.lang === 'html' && editor.getValue().trim() === '!') {
      const template = `<!DOCTYPE html>
<html lang=\"en\">
<head>
  <meta charset=\"UTF-8\">
  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
  <title>Document</title>
</head>
<body>
  
</body>
</html>`;
      editor.setValue(template);
      editor.setPosition({ lineNumber: 9, column: 3 });
    }
  });
  
  // Load files
  loadFiles();
  if(!Object.keys(files).length) {
    addFile('index.html', 'html');
  }
  refreshFiles();
  refreshTabs();
  openFile(Object.keys(files)[0]);
  updateEditorStatus();
  
  logConsole('Editor initialized', 'success');
});

// Button handlers
document.getElementById('newFileBtn').onclick = () => {
  const name = prompt('File name (e.g., style.css, script.js):');
  if(!name) return;
  const ext = name.split('.').pop().toLowerCase();
  const langMap = {
    html: 'html',
    htm: 'html',
    css: 'css',
    js: 'javascript',
    jsx: 'javascript',
    ts: 'typescript',
    tsx: 'typescript',
    py: 'python',
    json: 'json',
    md: 'markdown'
  };
  addFile(name, langMap[ext] || 'plaintext');
};

document.getElementById('formatBtn').onclick = () => {
  if(!activeFile) return;
  const lang = files[activeFile].lang;
  const code = editor.getValue();
  
  try {
    let formatted;
    if(lang === 'html') {
      formatted = prettier.format(code, {
        parser: 'html',
        plugins: prettierPlugins,
        printWidth: 80,
        tabWidth: 2
      });
    } else if(lang === 'javascript') {
      formatted = prettier.format(code, {
        parser: 'babel',
        plugins: prettierPlugins,
        printWidth: 80,
        tabWidth: 2,
        singleQuote: true
      });
    } else {
      logConsole('Format not available for this file type', 'warning');
      return;
    }
    editor.setValue(formatted);
    logConsole('Code formatted successfully', 'success');
  } catch(e) {
    logConsole(`Format error: ${e.message}`, 'error');
  }
};

document.getElementById('runBtn').onclick = async () => {
  if(!activeFile) {
    logConsole('No file selected', 'warning');
    return;
  }
  
  const file = files[activeFile];
  const code = file.content;
  const lang = file.lang;
  
  logConsole(`Running ${activeFile}...`, 'info');
  
  if(lang === 'html') {
    document.getElementById('preview').srcdoc = code;
    logConsole('HTML preview updated', 'success');
  } else if(lang === 'javascript') {
    try {
      const html = `<!DOCTYPE html>
<html>
<head>
  <style>body{font-family:system-ui;padding:20px;}</style>
</head>
<body>
  <script>
    console.log = function(...args) {
      document.body.innerHTML += '<div>' + args.join(' ') + '</div>';
    };
 </body>
  </html>'
    ${code};
    
      document.getElementById('preview').srcdoc = html;
      logConsole('JavaScript executed', 'success');
    } catch(e) {
      logConsole(`JavaScript error: ${e.message}`, 'error');
    }
  } else if(lang === 'python') {
    await runPython(code);
  } else {
    logConsole('Preview not available for this file type', 'warning');
  }
};

document.getElementById('exportBtn').onclick = () => {
  if(!activeFile) return;
  const blob = new Blob([files[activeFile].content], {type: 'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = activeFile;
  a.click();
  logConsole(`Exported ${activeFile}`, 'success');
};

document.getElementById('importBtn').onclick = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.multiple = true;
  input.onchange = (e) => {
    Array.from(e.target.files).forEach(file => {
      const reader = new FileReader();
      reader.onload = () => {
        const ext = file.name.split('.').pop().toLowerCase();
        const langMap = {
          html: 'html',
          css: 'css',
          js: 'javascript',
          py: 'python',
          json: 'json',
          md: 'markdown'
        };
        files[file.name] = {
          content: reader.result,
          lang: langMap[ext] || 'plaintext'
        };
        saveFiles();
        refreshFiles();
        refreshTabs();
        logConsole(`Imported ${file.name}`, 'success');
      };
      reader.readAsText(file);
    });
  };
  input.click();
};

document.getElementById('clearConsole').onclick = () => {
  document.getElementById('console').innerHTML = '';
  logConsole('Console cleared', 'info');
};

// Python execution
async function runPython(code) {
  document.getElementById('pyodideOverlay').classList.remove('hidden');
  
  try {
    if(!window.pyodide) {
      document.getElementById('pyStatus').textContent = 'Loading Python runtime...';
      document.getElementById('pyProgress').style.width = '30%';
      
      window.pyodide = await loadPyodide({
        indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.23.4/full/'
      });
      
      document.getElementById('pyProgress').style.width = '100%';
      logConsole('Pyodide loaded', 'success');
    }
    
    document.getElementById('pyodideOverlay').classList.add('hidden');
    
    const result = await window.pyodide.runPythonAsync(code);
    if(result !== undefined) {
      logConsole(`Python output: ${result}`, 'success');
    } else {
      logConsole('Python executed successfully', 'success');
    }
  } catch(e) {
    document.getElementById('pyodideOverlay').classList.add('hidden');
    logConsole(`Python error: ${e.message}`, 'error');
  }
}

document.getElementById('pyCancel').onclick = () => {
  document.getElementById('pyodideOverlay').classList.add('hidden');
};

// Window resize handler
window.onresize = () => {
  if(editor) editor.layout();
};
</script>
</body>
</html>
"
Observation: Create successful: /app/code-improved.html
